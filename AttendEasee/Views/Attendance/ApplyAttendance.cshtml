@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Apply for Attendance</h2>

<form class="form" id="applyAttendanceForm">
    <div class="form-group">
        <label for="userId">User ID</label>
        <input type="number" id="userId" name="userId" class="form-control" required />
    </div>

    <div class="form-group">
        <label for="attendanceDate">Attendance Date</label>
        <input type="date" id="attendanceDate" name="attendanceDate" class="form-control" required />
    </div>

    <br/>
    <button type="button" onclick="applyAttendance()" class="btn btn-primary">Apply</button>
</form>

@section Scripts {
    <script>
        function applyAttendance() {
            var formData = {
                UserId: $("#userId").val(),
                Date: $("#attendanceDate").val()
            };

            fetch(`/Attendance/ApplyAttendance`, {
                method: "POST",
                body: JSON.stringify(formData),
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            }).then(response => {
                if (response.ok) {
                    Swal.fire({
                        title: 'Success!',
                        text: 'Attendance applied successfully',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    });
                } else {
                    response.text().then(text => {
                        Swal.fire({
                            title: 'Error!',
                            text: text,
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    });
                }
            }).catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    title: 'Error!',
                    text: 'An error occurred: ' + error.message,
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            });
        }
    </script>
}
